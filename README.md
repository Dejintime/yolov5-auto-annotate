# YOLOv5 智能目标检测与自动标注系统

这是一个基于 **YOLOv5** 和 **FastAPI** 构建的综合性计算机视觉实训平台。该系统集成了图像目标检测、可视化智能标注、数据集管理以及模型训练与评估功能，旨在提供一个从数据处理到模型部署的完整闭环工作流。

## 🚀 系统功能

### 1. 🖼️ 智能目标检测 (Object Detection)
*   **图像上传**：支持前端上传本地图片。
*   **实时推理**：调用 YOLOv5s 预训练模型进行目标检测。
*   **可视化展示**：在前端 Canvas 上自动绘制检测框和类别标签。

### 2. ✍️ 交互式智能标注 (Interactive Annotation)
*   **自动预标注**：利用模型检测结果作为初始标注，减少人工工作量。
*   **人工修正**：
    *   **拖拽调整**：支持鼠标拖动检测框位置、拉伸调整大小。
    *   **类别修改**：点击检测框即可修改类别名称。
    *   **删除误检**：支持快捷键删除错误的检测框。
*   **数据保存**：一键保存修正后的标注数据，自动生成 **Pascal VOC 格式 (XML)** 标签文件，并同步保存原图，直接用于后续训练。

### 3. 🔥 模型训练 (Model Training)
*   **参数配置**：前端可视化配置训练参数（Epochs, Batch Size, Image Size 等）。
*   **异步训练**：后端采用异步任务处理训练过程，不阻塞界面操作。
*   **状态监控**：实时轮询训练状态，前端展示训练进度和日志信息。
*   **资源优化**：针对 Windows 环境优化了数据加载线程配置，防止内存溢出。

### 4. 📊 模型评估 (Model Evaluation)
*   **一键评估**：加载训练好的最佳权重 (`best.pt`) 对验证集进行评估。
*   **指标可视化**：自动解析评估日志，在前端仪表盘直观展示核心指标：
    *   **Precision (精确率)**
    *   **Recall (召回率)**
    *   **mAP@0.5**
    *   **mAP@0.5:0.95**

## 🛠️ 技术栈

*   **前端**：HTML5, Vue 3, Element Plus, Fabric.js (用于 Canvas 交互), Axios
*   **后端**：Python 3.8+, FastAPI, Uvicorn
*   **算法核心**：PyTorch, YOLOv5
*   **数据格式**：Pascal VOC (XML), JSON

## 📂 目录结构

```text
F:\2026实训\
├── annotations/        # [自动生成] 保存标注结果 (XML + 图片)
├── results/            # [自动生成] 保存推理过程中的临时图片
├── runs/               # [自动生成] YOLOv5 训练和评估结果日志
├── yolov5/             # YOLOv5 核心代码库
├── main.py             # 后端入口文件 (FastAPI)
├── index.html          # 前端入口文件 (Vue3 单页应用)
└── requirements.txt    # 项目依赖
```

## ⚡ 快速开始

### 1. 环境准备
确保已安装 Python 3.8+ 和 PyTorch (建议 GPU 版本)。

```bash
# 安装依赖
pip install fastapi uvicorn pydantic pillow pyyaml tqdm seaborn
# 确保安装了 torch (根据你的 CUDA 版本选择安装命令)
```

### 2. 启动后端服务
在项目根目录下运行：

```bash
python main.py
```
或者：
```bash
uvicorn main:app --reload
```
服务默认运行在 `http://127.0.0.1:8000`。

### 3. 访问系统
打开浏览器访问：
`http://127.0.0.1:8000/`

## 📝 使用指南

1.  **标注数据**：
    *   进入“智能标注”标签页。
    *   上传图片 -> 等待自动检测 -> 手动微调框的位置和类别 -> 点击“保存结果”。
    *   数据会自动保存到 `annotations/` 目录。

2.  **训练模型**：
    *   进入“模型训练”标签页。
    *   设置 Epochs (建议 50+) 和 Batch Size (显存小建议选 4)。
    *   点击“开始训练”。

3.  **评估模型**：
    *   训练完成后，点击“运行评估”。
    *   查看下方的仪表盘指标。

## ⚠️ 常见问题

*   **训练时报错 `bad allocation`**：通常是内存不足。请在前端将 Batch Size 调小 (例如 4)，后端代码已默认强制单线程加载数据以节省内存。
*   **评估指标显示为 0**：请检查是否已完成训练，且 `runs/train/custom_exp/weights/best.pt` 文件存在。

## 🤝 贡献
欢迎提交 Issue 或 Pull Request 改进本项目。
